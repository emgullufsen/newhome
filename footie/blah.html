<html>

<head>
    <meta charset="utf-8">
    <style>
        img {
            max-height: 100px;
        }

        td,
        th {
            text-align: center;
            border-bottom-style: solid;
            border-color: blueviolet;

        }

        table {
            border-collapse: collapse;
            border-style: solid;
            margin: auto;
            border-color: blue;
        }
        #day_buttons {
            text-align: center;
            
        }
    </style>
    <script src="data-async.js"></script>
</head>

<body>

    <div id="day_buttons">

    </div>
    <table id="scoreboard_table">
        <thead>
            <tr>
                <th>Country</th>
                <th>League</th>
                <th>Home Team</th>
                <th>Away Team</th>
                <th>Score</th>
            </tr>

        </thead>
        <tbody id="scoreboard_table_body">

        </tbody>
    </table>
    <script>
        let tbod = document.getElementById("scoreboard_table_body");
        function fixture_func(item) {
            let new_row = tbod.insertRow(-1);
            let nc_0 = new_row.insertCell(0);
            let nc_1 = new_row.insertCell(1);
            let nc_2 = new_row.insertCell(2);
            let nc_3 = new_row.insertCell(3);
            let nc_4 = new_row.insertCell(4);

            let country_image = document.createElement('img');
            let league_image = document.createElement('img');
            let homeTeam_image = document.createElement('img');
            let awayTeam_image = document.createElement('img');

            let country_figure = document.createElement('figure');
            let league_figure = document.createElement('figure');
            let homeTeam_figure = document.createElement('figure');
            let awayTeam_figure = document.createElement('figure');

            let country_figcaption = document.createElement('figcaption');
            let league_figcaption = document.createElement('figcaption');
            let homeTeam_figcaption = document.createElement('figcaption');
            let awayTeam_figcaption = document.createElement('figcaption');

            country_figcaption.innerHTML = item.league.country;
            league_figcaption.innerHTML = item.league.name;
            homeTeam_figcaption.innerHTML = item.homeTeam.team_name;
            awayTeam_figcaption.innerHTML = item.awayTeam.team_name;

            country_image.src = item.league.flag;
            league_image.src = item.league.logo;
            homeTeam_image.src = item.homeTeam.logo;
            awayTeam_image.src = item.awayTeam.logo;

            country_figure.appendChild(country_image);
            country_figure.appendChild(country_figcaption);

            league_figure.appendChild(league_image);
            league_figure.appendChild(league_figcaption);

            homeTeam_figure.appendChild(homeTeam_image);
            homeTeam_figure.appendChild(homeTeam_figcaption);

            awayTeam_figure.appendChild(awayTeam_image);
            awayTeam_figure.appendChild(awayTeam_figcaption);

            nc_0.appendChild(country_figure);
            nc_1.appendChild(league_figure);
            nc_2.appendChild(homeTeam_figure);
            nc_3.appendChild(awayTeam_figure);
            nc_4.innerHTML = item.score.fulltime;
        }
        let us = new URLSearchParams(window.location.search);

        let ds = us.get("DATE");
        let the_day = new Date();

        if (ds !== null) {
            the_day = new Date(ds);
        }

        let tomorrow = new Date(the_day);
        let yesterday = new Date(the_day);
        tomorrow.setDate(the_day.getDate() + 1);
        yesterday.setDate(the_day.getDate() - 1);

        let button_div = document.getElementById("day_buttons");
        let anchor_tomorrow = document.createElement('a');
        let anchor_yesterday = document.createElement('a');

        anchor_tomorrow.setAttribute('title', 'Next Day');
        anchor_tomorrow.href = window.location.href.split('?')[0] + '?DATE=' + tomorrow.toISOString().split('T')[0];
        anchor_tomorrow.appendChild(document.createTextNode("Next Day"));

        anchor_yesterday.setAttribute('title', 'Previous Day');
        anchor_yesterday.href = window.location.href.split('?')[0] + '?DATE=' + yesterday.toISOString().split('T')[0];
        anchor_yesterday.appendChild(document.createTextNode("Previous Day"));

        button_div.appendChild(anchor_yesterday);
        button_div.appendChild(anchor_tomorrow);        

        getMatchesFromSource(the_day).then(
            function (data) {
                let fixs = data.api.fixtures;
                fixs.sort((a, b) => (a.league_id < b.league_id) ? -1 : 1);
                data.api.fixtures.forEach(fixture_func);
                console.log(fixs);
            }
        );
    </script>
</body>

</html>